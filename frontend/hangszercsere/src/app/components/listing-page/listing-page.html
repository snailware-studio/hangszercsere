<div class="w-full min-h-screen bg-light-site-bg dark:bg-site-bg py-10">
  <div class="max-w-5xl mx-auto px-4 flex flex-col gap-10">

    <!-- Title + Price -->
    <div>
      <h1 class="text-4xl font-bold text-light-text-primary dark:text-text-primary mb-2">
        {{ listing?.title }}
      </h1>
      <p class="text-2xl font-semibold text-accent mb-4">
        {{ listing?.price }} Ft
      </p>
      <hr class="border-gray-300 dark:border-gray-700">
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">

      <!-- LEFT SIDE: Images & Videos -->
      <div class="flex flex-col gap-6">

        <!-- Image Gallery -->
        <div *ngIf="listing?.images?.length" class="flex flex-col gap-3">
          <div class="grid grid-cols-2 gap-3">
            <ng-container *ngFor="let img of listing?.images; let i = index">
              <img [src]="rootUrl + '/uploads/' + img" class="cursor-pointer w-64 h-64 object-cover rounded"
                (click)="lightbox.show(i)">
            </ng-container>
          </div>
        </div>

        <!-- Videos -->
        <div *ngIf="listing?.videos?.length" class="flex flex-col gap-4">
          <ng-container *ngFor="let video of listing?.videos">
            <video controls class="rounded-lg shadow-md w-full">
              <source [src]="rootUrl + '/uploads/' + video" type="video/mp4">
            </video>
          </ng-container>
        </div>

      </div>

      <!-- RIGHT SIDE: Details -->
      <div class="flex flex-col gap-5">


        <markdown class="
    prose
    dark:prose-invert
    max-w-none
    text-light-text-primary
    dark:text-text-primary
  " [data]="listing?.description">
        </markdown>


        <div class="text-light-text-primary font-semibold dark:text-text-primary flex flex-col gap-1">

          <p><span class="font-semibold">Kategória:</span> {{ listing?.category }}</p>
          <p class="flex items-center gap-2">
            <span class="font-semibold">Állapot:</span>

            <span [ngClass]="{
      'text-green-500 border-green-500': listing?.condition === 'Új',
      'text-emerald-400 border-emerald-400': listing?.condition === 'Nagyon jó',
      'text-yellow-500 border-yellow-500': listing?.condition === 'Jó',
      'text-orange-500 border-orange-500': listing?.condition === 'Elfogadható'
    }" class="px-2 py-1 rounded border bg-transparent dark:bg-gray-800 text-sm">
              {{ listing?.condition }}
            </span>
          </p>

          <p><span class="font-semibold">Márka:</span> {{ listing?.brand }}</p>
          <p><span class="font-semibold">Modell:</span> {{ listing?.model }}</p>

          <p><span class="font-semibold">Értékelés:</span>
            <ng-container *ngIf="listing?.ai_rating !== null && listing?.ai_rating !== undefined">
              {{ listing?.ai_rating }}/5 ⭐
            </ng-container>
            <ng-container *ngIf="listing?.ai_rating === null || listing?.ai_rating === undefined">
              Nincs értékelés
            </ng-container>
          </p>

        </div>

        <div class="text-light-text-secondary dark:text-text-secondary flex flex-col gap-1">
          <p (click)="GotoProfile(listing?.user_id)"><span class="font-semibold">Eladó:</span> <span class="button">{{
              listing?.seller }}</span></p>
          <p><span class="font-semibold">Feltöltve:</span> {{ listing?.created_at | date:'mediumDate' }}</p>
        </div>


        <!-- IF current user isnt the seller -->
        <ng-container *ngIf="GetUserId() != listing?.user_id">

          <!-- ADD TO CART BUTTON -->
          <button class="bg-accent text-white font-semibold py-3 rounded hover:bg-lime-500 bg-lime-600
                    transition w-full md:w-1/2" (click)="AddToCart(listing.id)">
            <i class="nf nf-fa-cart_shopping"></i> Kosárba
          </button>

          <!-- Message seller -->
          <button class="bg-purple-700 text-white font-semibold py-3 rounded hover:bg-purple-600
                    transition w-full md:w-1/2" (click)="StartChat(listing)">
            Üzenet
          </button>

        </ng-container>
        <ng-container *ngIf="GetUserId() == listing?.user_id">
          <!-- Edit listing -->
          <button class="bg-violet-800 text-white font-semibold py-3 rounded hover:bg-violet-700
                    transition w-full md:w-1/2 text-white bg-blue-500" (click)="EditListing(listing?.id)">
            Módosítás
          </button>

          <button (click)="RemoveListing(listing.id)" class="bg-red-600 text-white font-semibold py-2 rounded w-full md:w-1/2
                   hover:bg-red-700 transition">
            Törlés
          </button>
        </ng-container>

      </div>
    </div>

  </div>
</div>

<app-lightbox #lightbox [images]="listing?.images"></app-lightbox>