<div class="p-4">
  <app-filter></app-filter>
</div>

<div class="product-container grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 p-4">

  <ng-container *ngIf="!listings">
    <p class="text-light-text-secondary dark:text-purple-300/70">
      Nincs található hírdetés... :(
    </p>
  </ng-container>

  <ng-container *ngIf="listings?.length === 0">
    <div class="flex justify-center items-center h-40">
      <div class="w-10 h-10 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin"></div>
    </div>
  </ng-container>

  <!-- PRODUCT CARD -->
  <div
    *ngFor="let listing of listings"
    routerLink="/listing"
    (click)="viewListing(listing.id); SetListing(listing);"
    class="group cursor-pointer rounded-xl overflow-hidden
           bg-white dark:bg-[#241e34]
           border border-zinc-200 dark:border-[#3a3155]
           transition-all duration-300
           hover:-translate-y-1 hover:shadow-lg
           dark:hover:shadow-purple-900/30
           min-h-[400px] flex flex-col">

    <!-- IMAGE -->
    <div class="relative aspect-[4/3] overflow-hidden">
      <img
        [src]="rootUrl + '/uploads/' + listing.images[0]"
        alt="Listing image"
        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
      />

      <!-- PRICE -->
      <div class="absolute bottom-2 right-2 bg-black/70 text-white text-sm font-semibold px-3 py-1 rounded-full">
        {{ listing.price }} Ft
      </div>

      <!-- CONDITION -->
      <div
        class="absolute top-2 left-2 text-xs px-2 py-1 rounded-full border backdrop-blur-sm"
        [ngClass]="{
          'text-green-400 border-green-400': listing?.condition === 'Új',
          'text-emerald-400 border-emerald-400': listing?.condition === 'Nagyon jó',
          'text-yellow-400 border-yellow-400': listing?.condition === 'Jó',
          'text-orange-400 border-orange-400': listing?.condition === 'Elfogadható'
        }">
        {{ listing?.condition }}
      </div>
    </div>

    <!-- CONTENT -->
    <div class="p-4 flex-1 flex flex-col justify-between">

      <!-- TITLE + DESCRIPTION -->
      <div>
        <h3 class="font-semibold text-base leading-snug line-clamp-2">
          {{ listing.title }}
        </h3>

        <p class="text-sm text-gray-500 dark:text-purple-200/70 line-clamp-2">
          {{ listing.description }}
        </p>
      </div>

      <!-- FOOTER -->
      <div class="pt-3 border-t border-zinc-200 dark:border-[#3a3155] mt-4">

        <!-- SELLER + TIME -->
        <div class="flex justify-between items-center text-xs text-gray-400 dark:text-purple-300/60 mb-2">
          <span class="flex items-center gap-1">
            <i class="nf nf-md-account"></i>
            {{ listing.seller }}
          </span>

          <span class="flex items-center gap-1">
            <i class="nf nf-weather-time_2"></i>
            {{ listing.created_at | timeAgo }}
          </span>
        </div>

        <div class="relative inline-block text-lg leading-none">
          <div class="text-gray-300">
            ★★★★★
          </div>
          <div
            class="absolute top-0 left-0 overflow-hidden text-yellow-400 whitespace-nowrap"
            [style.width]="'calc(' + (+listing.ai_rating * 1.6) + 'ch)'">
            ★★★★★
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
